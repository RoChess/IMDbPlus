<ScriptableScraper>
	<details>
		<!-- These details are for display purposes only. -->
		<name>IMDb+</name>
		<author>Ron (RoChess)</author>
		<description>Combination scraper, using the best data from IMDb and RottenTomatoes.</description>

	<!-- Replace the following with <id>874902</id> to avoid having to re-import your collection. -->
		<id>314159265</id>
	<!-- This will fool MovingPictures into thinking this scraper is the new imdb.com scraper. -->

		<version major="3" minor="3" point="2" />
		<published month="10" day="15" year="2011" />
		<type>MovieDetailsFetcher|MovieCoverFetcher</type>
		<language>en</language>
	</details>


<!-- Global Options -->

	<!--
	It is not yet possible to configure options for a scraper script.
	So please star issue: http://code.google.com/p/moving-pictures/issues/detail?id=319

	This means that you have to manually change the global_options.

	You can either adjust them below *BEFORE* importing this scraper script.

	NEW:	Or you can now use the "C:\Options IMDb+ Scraper.xml" config file to adjust
		the global options on the fly without having to re-import the scraper script.

	Use *ONLY* value="true" or value="false" to make sure that everything works
	-->


<!-- Details Node -->

	<action name="get_details">

		<!-- ### OPTIONS ### -->						<!--       TRUE		|         FALSE		-->
			<set name="global_options_original_title" value="false" />	<!-- Original Title	| Always English Title	-->
			<set name="global_options_foreign_title" value="false" />	<!-- English (Original)	| Main title only	-->
			<set name="global_options_foreign_first" value="false" />	<!-- Original (English)	| English (Original)	-->
			<set name="global_options_uk_rating" value="false" />		<!-- UK certification	| US certification	-->
			<set name="global_options_imdb_score" value="false" />		<!-- Use IMDb.com	| RottenTomatoes.com	-->
			<set name="global_options_imdb_metascore" value="false" />	<!-- Metacritics score	| Use IMDb if enabled	-->
			<set name="global_options_long_summary" value="false" /> 	<!-- Long summary	| Short summary		-->
			<set name="global_options_rotten_meter" value="false" /> 	<!-- TomatoMeter	| Audience		-->
			<set name="global_options_rotten_average" value="false" />	<!-- Average value	| Percentage value	-->
			<set name="global_options_rotten_top_critics" value="false" />	<!-- Top critics meter	| All critics meter	-->
			<set name="global_options_special_edition" value="false" />	<!-- Modify title	| Keep title as-is	-->
			<set name="global_options_rename_titles" value="false" />	<!-- Rename titles	| Keep title as-is	-->
			<set name="global_options_single_score" value="false" />	<!-- Use only 1 score	| Average the scores	-->
			<set name="global_options_min_imdb_votes" value="false" />	<!-- Min. of 20 votes	| Force imdb score	-->
			<set name="global_options_refresh_all_fields" value="false" />	<!-- Update All Fields	| Update A Few + Empty	-->
			<set name="global_options_one_writer_director" value="false" />	<!-- Only use one name	| Get all the names	-->

			<!--
				Because IMDb offers their site in five other languages and they use the same tt-ID,
				the following setting was added to use available information from those sites.

				For now this is limited to (short) summary, genres and certifications when available.
				There are also other non-English sites included that support direct lookup based on tt-ID.

					01 = imdb.com for default English
					02 = imdb.de for German
					03 = imdb.es for Spanish
					04 = imdb.fr for French
					05 = imdb.it for Italian
					06 = imdb.pt for Portuguese
					07 = filmtipset.se for Swedish
					08 = kvikmyndir.is for Icelandic
			-->
			<set name="global_options_secondary_summary" value="false" />	<!-- English if empty	| Only foreign summary	-->
			<set name="global_options_secondary_details" value="01" />

			<!--
				Special filter to include other language titles besides English (en)
				Use the imdb.com HTML source to find the ISO 639-1 code after /language/

				Example: for English + Norwegian + Swedish use value="en|no|sv"

				The country filter was added to avoid mistakes on foreign movies in English
			-->
			<set name="global_options_country_filter" value="us|ca|gb|ie|au|nz" />
			<set name="global_options_language_filter" value="en" />
		<!-- ### OPTIONS ### -->

		<!-- Overwrite global_options based on the contents of XML file in (C) root folder -->
		<!-- This makes it possible to retain custom changes across scraper updates -->
		<!-- and try different settings without the need to reimport the script. -->
		<set name="rx_file_check">
			<![CDATA[
			(<imdbplus[^>]*>)(?:[\r\n\t\s\v]*<set[\t\s]+id="\d+"[\t\s]+name="global_options_[^"]+"[\t\s]+value="(?:true|false)"[\t\s]*/>)*[\r\n\t\s\v]*<set[\t\s]+id="97"[\t\s]+name="global_options_secondary_details"[\t\s]+value="\d{2}"[\t\s]*/>[\r\n\t\s\v]*<set[\t\s]+id="98"[\t\s]+name="global_options_country_filter"[^>]+>[\r\n\t\s\v]*<set[\t\s]+id="99"[\t\s]+name="global_options_language_filter"[^>]+>[^\x00]*</imdbplus>
			]]>
		</set>
		<retrieve name="file" file="C:\Options IMDb+ Scraper.xml" encoding="UTF-8" />
		<parse name="fileCheck" input="${file}" regex="${rx_file_check}" />
		<if test="${fileCheck.count}>0">
			<if test="${fileCheck[0][0]}!=">
				<parse name="xml_option" input="${file}" xpath="//set[@id=01]" />
				<set name="global_options_original_title" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=02]" />
				<set name="global_options_foreign_title" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=03]" />
				<set name="global_options_foreign_first" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=04]" />
				<set name="global_options_uk_rating" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=05]" />
				<set name="global_options_imdb_score" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=06]" />
				<set name="global_options_imdb_metascore" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=07]" />
				<set name="global_options_long_summary" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=08]" />
				<set name="global_options_rotten_meter" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=09]" />
				<set name="global_options_rotten_average" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=10]" />
				<set name="global_options_rotten_top_critics" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=11]" />
				<set name="global_options_special_edition" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=12]" />
				<set name="global_options_rename_titles" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=13]" />
				<set name="global_options_single_score" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=14]" />
				<set name="global_options_min_imdb_votes" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=15]" />
				<set name="global_options_refresh_all_fields" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=16]" />
				<set name="global_options_one_writer_director" value="${xml_option[0].@value}" />

				<parse name="xml_option" input="${file}" xpath="//set[@id=96]" />
				<set name="global_options_secondary_summary" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=97]" />
				<set name="global_options_secondary_details" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=98]" />
				<set name="global_options_country_filter" value="${xml_option[0].@value}" />
				<parse name="xml_option" input="${file}" xpath="//set[@id=99]" />
				<set name="global_options_language_filter" value="${xml_option[0].@value}" />

				<log LogLevel="Info" Message="IMDb+ Scraper: Settings overruled via Options XML file" />
			</if>
		</if>
		<if test="${fileCheck.count}=0">
			<log LogLevel="Warn" Message="IMDb+ Scraper Notice: No XML file found for options, default values are used" />
		</if>

		<!-- if the site id is not set try to set it using the imdb id -->
		<if test="${movie.site_id}=">
			<if test="${movie.imdb_id}!=">
				<set name="movie.site_id" value="${movie.imdb_id}" />
			</if>
		</if>

		<!-- if we have a site id (imdb id) we can continue -->
		<if test="${movie.site_id}!=">

			<if test="${global_options_special_edition}=true">
				<!-- Check details_url for presence of special edition title -->
				<parse name="special_edition" input="${movie.details_url}" regex="###(.+?)###" />
				<!-- Backup existing special edition title, incase this is a refresh -->
				<parse name="special_backup" input="${movie.title}" regex="([\(\[\{](?:3D|Extended|Unrated|Director's Cut|Alternate Ending)(?: Edition)?[\}\]\)])" />
			</if>

			<set name="site" value="http://akas.imdb.com/title/${movie.site_id}" />
			<retrieve name="details_page" url="${site}" />

			<if test="${global_options_secondary_details}>1">
				<if test="${global_options_secondary_details}=2">
					<!-- Avatar = http://www.imdb.de/title/tt0499549 -->
					<set name="alt_site" value="http://www.imdb.de/title/${movie.site_id}" />
					<set name="rx_genres_block" value="&lt;h5&gt;Genre:&lt;/h5&gt;[^&gt;]+?&gt;\s+(.+?)\s+?&lt;/div&gt;" />
					<set name="rx_genres" value="\s*([^\|]+)" />
					<set name="rx_plot2">
						<![CDATA[
						<h5>Handlung:</h5>[^>]+>\s+?(?<moviePlotShort>[^<]*)(?: \|)?\s+?<a
						]]>
					</set>
					<set name="rx_language">
						<![CDATA[
						<h5>Sprache:</h5>[^>]+>(?<movieLanguage>.+?)(?:\s\|[^<]+)?<
						]]>
					</set>
					<log LogLevel="Info" Message="IMDb+ Scraper: German (imdb.de) used for some data on: ${movie.site_id}" />
				</if>
				<if test="${global_options_secondary_details}=3">
					<!-- Avatar = http://www.imdb.es/title/tt0499549 -->
					<set name="alt_site" value="http://www.imdb.es/title/${movie.site_id}" />
					<set name="rx_genres_block" value="&lt;h5&gt;G&amp;#xE9;nero:&lt;/h5&gt;[^&gt;]+?&gt;\s+(.+?)\s+?&lt;/div&gt;" />
					<set name="rx_genres" value="\s*([^\|]+)" />
					<set name="rx_plot2">
						<![CDATA[
						<h5>Trama:</h5>[^>]+>\s+?(?<moviePlotShort>[^<]*)(?: \|)?\s+?<a
						]]>
					</set>
					<set name="rx_language">
						<![CDATA[
						<h5>Idioma:</h5>[^>]+>(?<movieLanguage>.+?)(?:\s\|[^<]+)?<
						]]>
					</set>
					<log LogLevel="Info" Message="IMDb+ Scraper: Spanish (imdb.es) used for some data on: ${movie.site_id}" />
				</if>
				<if test="${global_options_secondary_details}=4">
					<!-- Avatar = http://www.imdb.fr/title/tt0499549 -->
					<set name="alt_site" value="http://www.imdb.fr/title/${movie.site_id}" />
					<set name="rx_genres_block" value="&lt;h5&gt;Genre:&lt;/h5&gt;[^&gt;]+?&gt;\s+(.+?)\s+?&lt;/div&gt;" />
					<set name="rx_genres" value="\s*([^\|]+)" />
					<set name="rx_plot2">
						<![CDATA[
						<h5>Intrigue:</h5>[^>]+>\s+?(?<moviePlotShort>[^<]*)(?: \|)?\s+?<a
						]]>
					</set>
					<set name="rx_language">
						<![CDATA[
						<h5>Langue:</h5>[^>]+>(?<movieLanguage>.+?)(?:\s\|[^<]+)?<
						]]>
					</set>
					<log LogLevel="Info" Message="IMDb+ Scraper: French (imdb.fr) used for some data on: ${movie.site_id}" />
				</if>
				<if test="${global_options_secondary_details}=5">
					<!-- Avatar = http://www.imdb.it/title/tt0499549 -->
					<set name="alt_site" value="http://www.imdb.it/title/${movie.site_id}" />
					<set name="rx_genres_block" value="&lt;h5&gt;Genere:&lt;/h5&gt;[^&gt;]+?&gt;\s+(.+?)\s+?&lt;/div&gt;" />
					<set name="rx_genres" value="\s*([^\|]+)" />
					<set name="rx_plot2">
						<![CDATA[
						<h5>Trama:</h5>[^>]+>\s+?(?<moviePlotShort>[^<]*)(?: \|)?\s+?<a
						]]>
					</set>
					<set name="rx_language">
						<![CDATA[
						<h5>Lingua:</h5>[^>]+>(?<movieLanguage>.+?)(?:\s\|[^<]+)?<
						]]>
					</set>
					<log LogLevel="Info" Message="IMDb+ Scraper: Italian (imdb.it) used for some data on: ${movie.site_id}" />
				</if>
				<if test="${global_options_secondary_details}=6">
					<!-- Avatar = http://www.imdb.pt/title/tt0499549 -->
					<set name="alt_site" value="http://www.imdb.pt/title/${movie.site_id}" />
					<set name="rx_genres_block" value="&lt;h5&gt;G&amp;#xEA;nero:&lt;/h5&gt;[^&gt;]+?&gt;\s+(.+?)\s+?&lt;/div&gt;" />
					<set name="rx_genres" value="\s*([^\|]+)" />
					<set name="rx_plot2">
						<![CDATA[
						<h5>Argumento:</h5>[^>]+>\s+?(?<moviePlotShort>[^<]*)(?: \|)?\s+?<a
						]]>
					</set>
					<set name="rx_language">
						<![CDATA[
						<h5>L\&\#xED;ngua:</h5>[^>]+>(?<movieLanguage>.+?)(?:\s\|[^<]+)?<
						]]>
					</set>
					<log LogLevel="Info" Message="IMDb+ Scraper: Portugese (imdb.pt) used for some data on: ${movie.site_id}" />
				</if>
				<if test="${global_options_secondary_details}=7">
					<!-- Avatar = http://www.nyheter24.se/filmtipset/imdb/tt0499549 -->
					<set name="alt_site" value="http://www.nyheter24.se/filmtipset/imdb/${movie.site_id}" />
					<set name="rx_genres_block" value="Genre:(.+?)&lt;/tr&gt;" />
					<set name="rx_genres" value="'&gt;(.*?)&lt;/a&gt;" />
					<set name="rx_plot2">
						<![CDATA[
						<tr><td[^>]+><h2>[^<]+</h2>\s*(?<moviePlotShort>[^<]+)</td></tr>
						]]>
					</set>
					<!-- Use imdb.com language info -->
					<log LogLevel="Info" Message="IMDb+ Scraper: Swedish (filmtipset.se) used for some data on: ${movie.site_id}" />
				</if>
				<if test="${global_options_secondary_details}=8">
					<!-- Avatar = http://kvikmyndir.is/xml/movingpictures/?id=0499549 -->
					<replace name="imdb_id_fixed" input="${movie.imdb_id}" pattern="tt" with='' />
					<set name="alt_site" value="http://kvikmyndir.is/xml/movingpictures/?id=${imdb_id_fixed}" />
					<set name="rx_genres_block" value="&lt;genre&gt;(.+?)&lt;/genre&gt;" />
					<set name="rx_genres" value="&lt;item&gt;(.+?)&lt;/item&gt;" />
					<set name="rx_plot2">
						<![CDATA[
						<plot>(?<moviePlotShort>[^<]+)</plot>
						]]>
					</set>
					<set name="rx_language">
						<![CDATA[
						<language>(?<movieLanguage>[^<]+)</language>
						]]>
					</set>
					<log LogLevel="Info" Message="IMDb+ Scraper: Icelandic (kvikmyndir.is) used for some data on: ${movie.site_id}" />
				</if>
				<retrieve name="foreign_page" url="${alt_site}" />
			</if>

			<set name="movie.imdb_id" value="${movie.site_id}" />

			<!-- clear SortBy, so that it can be properly redone by the plugin afterwards -->
			<!-- this is to ensure article removal when there is a forced English title change -->
			<set name="movie.sortby" value='' />

			<!-- Title is now done after directors, writers and actors, to be able to detect between new import and refresh -->

			<!-- Verify conditional update. There is no AND or OR support, so this will have to do -->
			<if test="${global_options_refresh_all_fields}=true"><set name="update_directors" value="true" /></if><if test="${movie.directors}="><set name="update_directors" value="true" /></if>
			<if test="${update_directors}=true">
				<!-- Directors -->
				<set name="rx_directors_block">
					<![CDATA[
					Director[s]?:\s*</h4>[^<]*(?<directors_block>.*?)</div>
					]]>
				</set>
				<set name="rx_directors">
					<![CDATA[
					<a\s+href="/name/nm\d{7}/"[^>]*>(?<movieDirectors>[^<]+)</a>
					]]>
				</set>
				<parse name="directors_block" input="${details_page}" regex="${rx_directors_block}" />
				<parse name="directors" input="${directors_block}" regex="${rx_directors}" />
				<if test="${global_options_one_writer_director}=true">
					<set name="movie.directors" value="${directors[0][0]:htmldecode}" />
				</if>
				<if test="${global_options_one_writer_director}=false">
					<set name="movie.directors" value='' />
					<loop name="currDirector" on="directors" limit="10">
						<set name="movie.directors" value="${movie.directors}|${currDirector[0]:htmldecode}" />
					</loop>
				</if>

				<set name="new_import" value="true" />
			</if>

			<if test="${global_options_refresh_all_fields}=true"><set name="update_writers" value="true" /></if><if test="${movie.writers}="><set name="update_writers" value="true" /></if>
			<if test="${update_writers}=true">
				<!-- Writers -->
				<set name="rx_writers_block">
					<![CDATA[
					Writer[s]?:\s*</h4>[^<]*(?<writers_block>.*?)</div>
					]]>
				</set>
				<set name="rx_writers">
					<![CDATA[
					<a\s+href="/name/nm\d{7}/"[^>]*>(?<movieWriters>[^<]+)</a>
					]]>
				</set>
				<parse name="writers_block" input="${details_page}" regex="${rx_writers_block}" />
				<parse name="writers" input="${writers_block}" regex="${rx_writers}" />
				<if test="${global_options_one_writer_director}=true">
					<set name="movie.writers" value="${writers[0][0]:htmldecode}" />
				</if>
				<if test="${global_options_one_writer_director}=false">
					<set name="movie.writers" value='' />
					<loop name="currWriter" on="writers" limit="10">
						<set name="movie.writers" value="${movie.writers}|${currWriter[0]:htmldecode}" />
					</loop>
				</if>

				<set name="new_import" value="true" />
			</if>

			<if test="${global_options_refresh_all_fields}=true"><set name="update_actors" value="true" /></if><if test="${movie.actors}="><set name="update_actors" value="true" /></if>
			<if test="${update_actors}=true">
				<!-- Actors -->
				<set name="rx_actors_block">
					<![CDATA[
					<h2>Cast</h2>(?<cast_block>.+?)<h2>Details</h2>
					]]>
				</set>
				<set name="rx_actors">
					<![CDATA[
					<td[^<]*<a\s+href="/name/nm\d{7}/"[^>]*>(?<movieActors>[^<]*)</a>
					]]>
				</set>
				<parse name="actors_block" input="${details_page}" regex="${rx_actors_block}" />
				<parse name="actors" input="${actors_block}" regex="${rx_actors}" />
				<set name="movie.actors" value='' />
				<loop name="currActor" on="actors" limit="30">
					<set name="movie.actors" value="${movie.actors}|${currActor[0]:htmldecode}" />
				</loop>

				<set name="new_import" value="true" />
			</if>

			<if test="${new_import}=true"><set name="update_title_and_year" value="true" /></if>
			<if test="${global_options_refresh_all_fields}=true"><set name="update_title_and_year" value="true" /></if><if test="${movie.title}="><set name="update_title_and_year" value="true" /></if><if test="${movie.year}="><set name="update_title_and_year" value="true" /></if>
			<if test="${update_title_and_year}=true">
				<!-- Title and Year -->
				<if test="${global_options_original_title}=true">
					<set name="rx_title_year">
						<![CDATA[
						<title>(?:IMDb[\s-]*)?(?<movieTitle>.+?)\s*\(\D*(?<movieYear>\d{4})[\/IVX]*\).*?</title>
						]]>
					</set>
				</if>
				<if test="${global_options_original_title}=false">
					<set name="rx_tmp_prefix">
						<![CDATA[
						<title>(?:IMDb[\s-]*)?(?<movieTitleEnglish>(?:(?=.+?<h4 class="inline">Country:</h4>.+?<a href="/country/
						]]>
					</set>
					<set name="rx_tmp_infix">
						<![CDATA[
						".+?<h4 class="inline">Language:</h4>\s*<a href="/language/
						]]>
					</set>
					<set name="rx_tmp_postfix">
						<![CDATA[
						")|(?!.+?<a href="releaseinfo#akas">)).+?)\s*\(\D*(?<movieYear>\d{4})[\/IVX]*\).*?</title>
						]]>
					</set>
					<set name="rx_title_year" value="${rx_tmp_prefix}(?:${global_options_country_filter})${rx_tmp_infix}(?:${global_options_language_filter})${rx_tmp_postfix}" />
				</if>

				<parse name="title_year" input="${details_page}" regex="${rx_title_year}" />
				<set name="movie.title" value="${title_year[0][0]:htmldecode}" />
				<set name="movie.year" value="${title_year[0][1]:htmldecode}" />
			</if>

			<if test="${global_options_refresh_all_fields}=true"><set name="update_studios" value="true" /></if><if test="${movie.studios}="><set name="update_studios" value="true" /></if>
			<if test="${update_studios}=true">
				<!-- Studios -->
				<set name="rx_studios_block">
					<![CDATA[
					<h4 class="inline">Production Co:</h4>(?<movieStudios>(?:[^<]*<a\s*href="[^"]+">[^<]+</a>)*)
					]]>
				</set>
				<set name="rx_studios">
					<![CDATA[
					<a\s*href="[^"]+">(?<movieStudios>[^<]+)</a>
					]]>
				</set>
				<parse name="studios_block" input="${details_page}" regex="${rx_studios_block}" />
				<parse name="studios" input="${studios_block}" regex="${rx_studios}" />
				<set name="movie.studios" value='' />
				<loop name="currStudio" on="studios" limit="10">
					<set name="movie.studios" value="${movie.studios}|${currStudio[0]:htmldecode}" />
				</loop>
			</if>

			<if test="${global_options_refresh_all_fields}=true"><set name="update_genres" value="true" /></if><if test="${movie.genres}="><set name="update_genres" value="true" /></if>
			<if test="${update_genres}=true">
				<!-- Genres -->
				<if test="${global_options_secondary_details}&lt;=1">
					<set name="rx_genres_block">
						<![CDATA[
						Genre[s]?:[^<]*</h4>(?<genres_block>.+?)</div>
						]]>
					</set>
					<set name="rx_genres">
						<![CDATA[
						<a href="(?:/Sections)?/[Gg]enre[s]?/[^/]+/?">(?<movieGenres>.+?)</a>
						]]>
					</set>
					<parse name="genres_block" input="${details_page}" regex="${rx_genres_block}" />
				</if>
				<if test="${global_options_secondary_details}>1">
					<parse name="genres_block" input="${foreign_page}" regex="${rx_genres_block}" />
				</if>
				<parse name="genres" input="${genres_block[0][0]}" regex="${rx_genres}" />
				<set name="movie.genres" value='' />
				<loop name="currGenre" on="genres" limit="30">
					<set name="movie.genres" value="${movie.genres}|${currGenre[0]:htmldecode}" />
				</loop>
			</if>

			<if test="${global_options_refresh_all_fields}=true"><set name="update_runtime" value="true" /></if><if test="${movie.runtime}=0"><set name="update_runtime" value="true" /></if>
			<if test="${update_runtime}=true">
				<!-- Runtime -->
				<set name="rx_runtime">
					<![CDATA[
					(?<movieRuntime>\d+) min&nbsp;&nbsp;-&nbsp;&nbsp;
					]]>
				</set>
				<parse name="runtime" input="${details_page}" regex="${rx_runtime}" />
				<set name="movie.runtime" value="${runtime[0][0]:htmldecode}" />
			</if>

			<if test="${global_options_refresh_all_fields}=true"><set name="update_tagline" value="true" /></if><if test="${movie.tagline}="><set name="update_tagline" value="true" /></if>
			<if test="${update_tagline}=true">
				<!-- Tagline -->
				<set name="rx_tagline">
					<![CDATA[
					Tagline[s]?:</h4>[\s\f\r]*(?<movieTagline>[^<]+)
					]]>
				</set>
				<parse name="tagline" input="${details_page}" regex="${rx_tagline}" />
				<set name="tagline_clean" value="${tagline[0][0]:striptags}" />
				<set name="movie.tagline" value="${tagline_clean:htmldecode}" />
			</if>

			<if test="${global_options_refresh_all_fields}=true"><set name="update_language" value="true" /></if><if test="${movie.language}="><set name="update_language" value="true" /></if>
			<if test="${update_language}=true">
				<!-- imdb.com (USA) + filmtipset.se (Swedish) -->
				<if test="${global_options_secondary_details}&lt;=1"><set name="grab_usa_language" value="true" /></if>
				<if test="${global_options_secondary_details}=7"><set name="grab_usa_language" value="true" /></if>
				<if test="${grab_usa_language}=true">
					<set name="rx_language">
						<![CDATA[
						<a\shref=./language/[^"]+"[^>]*>(?<movieLanguage>[^<]+)</a>
						]]>
					</set>
					<parse name="language" input="${details_page}" regex="${rx_language}" />
				</if>
				<!-- Foreign page language -->
				<if test="${grab_usa_language}!=true">
					<parse name="language" input="${foreign_page}" regex="${rx_language}" />
				</if>
				<set name="movie.language" value="${language[0][0]:htmldecode}" />
			</if>

		<!-- START: Certification -->
			<if test="${global_options_uk_rating}=true">
				<set name="rx_certification">
					<![CDATA[
					(?:>\s*UK:|Rated\s*)(?<movieCertification>(?:U)|(?:PG)|(?:12)|(?:12A)|(?:15)|(?:18)|(?:R18))(?:</a>|\s*for)
					]]>
				</set>
			</if>
			<if test="${global_options_uk_rating}=false">
				<set name="rx_certification">
					<![CDATA[
					(?:>\s*USA:|Rated\s*)(?<movieCertification>(?:G)|(?:PG)|(?:PG-13)|(?:R)|(?:X)|(?:NC-17))(?:</a>|\s*for)
					]]>
				</set>
			</if>
			<parse name="certification_usa" input="${details_page}" regex="${rx_certification}" />

			<!-- imdb.com (USA) -->
			<if test="${global_options_secondary_details}&lt;=1">
				<set name="movie.certification" value="${certification_usa[0][0]:htmldecode}" />
				<if test="${movie.certification}=">
					<retrieve name="parentalguide_page" url="${site}/parentalguide" />
					<parse name="certification" input="${parentalguide_page}" regex="${rx_certification}" />
					<set name="movie.certification" value="${certification[0][0]:htmldecode}" />
				</if>
			</if>
			<!-- imdb.de (German) -->
			<if test="${global_options_secondary_details}=2">
				<parse name="certification" input="${foreign_page}" regex="Deutschland:(\d+|o\.Al\.)" />
				<replace name="certification1" input="${certification[0][0]:htmldecode}" pattern="o\.Al\." with="0" />
				<set name="movie.certification" value="${certification1}" />
			</if>
			<!-- imdb.es (Spanish) -->
			<if test="${global_options_secondary_details}=3">
				<!-- Fix localized rating, forced to swap order, as 'G' gets replaced inside 'PG' and 'PG-13' otherwise -->
				<replace name="certification1" input="${certification_usa[0][0]:htmldecode}" pattern="X" with="X" />
				<replace name="certification2" input="${certification1}" pattern="NC-17" with="+18" />
				<replace name="certification3" input="${certification2}" pattern="R" with="+16" />
				<replace name="certification4" input="${certification3}" pattern="PG-13" with="+13" />
				<replace name="certification5" input="${certification4}" pattern="PG" with="+7" />
				<replace name="certification6" input="${certification5}" pattern="G" with="TP" />
				<set name="movie.certification" value="${certification6}" />
			</if>
			<!-- imdb.fr (French) -->
			<if test="${global_options_secondary_details}=4">
				<parse name="certification" input="${foreign_page}" regex="France:(-\d+|U)" />
				<set name="movie.certification" value="${certification[0][0]:htmldecode}" />
				<if test="${movie.certification}=">
					<!-- Fix localized rating, forced to swap order, as 'G' gets replaced inside 'PG' and 'PG-13' otherwise -->
					<replace name="certification1" input="${certification_usa[0][0]:htmldecode}" pattern="X" with="-18" />
					<replace name="certification2" input="${certification1}" pattern="NC-17" with="-18" />
					<replace name="certification3" input="${certification2}" pattern="R" with="-16" />
					<replace name="certification4" input="${certification3}" pattern="PG-13" with="-12" />
					<replace name="certification5" input="${certification4}" pattern="PG" with="-10" />
					<replace name="certification6" input="${certification5}" pattern="G" with="U" />
					<set name="movie.certification" value="${certification6}" />
				</if>
			</if>
			<!-- imdb.it (Italian) -->
			<if test="${global_options_secondary_details}=5">
				<parse name="certification" input="${foreign_page}" regex="Italia:((?:T)|(?:VPA)|(?:VM\d+)|(?:X))" />
				<set name="movie.certification" value="${certification[0][0]:htmldecode}" />
				<if test="${movie.certification}=">
					<!-- Fix localized rating, forced to swap order, as 'G' gets replaced inside 'PG' and 'PG-13' otherwise -->
					<replace name="certification1" input="${certification_usa[0][0]:htmldecode}" pattern="X" with="X" />
					<replace name="certification2" input="${certification1}" pattern="NC-17" with="VM18" />
					<replace name="certification3" input="${certification2}" pattern="R" with="VM14" />
					<replace name="certification4" input="${certification3}" pattern="PG-13" with="VM12" />
					<replace name="certification5" input="${certification4}" pattern="PG" with="VPA" />
					<replace name="certification6" input="${certification5}" pattern="G" with="T" />
					<set name="movie.certification" value="${certification6}" />
				</if>
			</if>
			<!-- imdb.pt (Portugese) -->
			<if test="${global_options_secondary_details}=6">
				<parse name="certification" input="${foreign_page}" regex="Portugal:([^\s]+)" />
				<set name="movie.certification" value="${certification[0][0]:htmldecode}" />
			</if>
			<!-- filmtipset.se (Swedish) -->
			<if test="${global_options_secondary_details}=7">
				<retrieve name="parentalguide_page" url="${site}/parentalguide" />
				<parse name="certification" input="${parentalguide_page}" regex="Sweden:(\d+|(?:Banned)|(?:Btl))" />
				<set name="movie.certification" value="${certification[0][0]:htmldecode}" />
			</if>
			<!-- kvikmyndir.is (Icelandic) -->
			<if test="${global_options_secondary_details}=8">
				<parse name="certification" input="${foreign_page}" regex="&lt;certificate&gt;(\d+)[^&lt;]+&lt;/certificate&gt;" />
				<set name="movie.certification" value="${certification[0][0]:htmldecode}" />
				<if test="${movie.certification}=">
					<retrieve name="parentalguide_page" url="${site}/parentalguide" />
					<parse name="certification" input="${parentalguide_page}" regex="Iceland:(\d+|L)" />
					<set name="movie.certification" value="${certification[0][0]:htmldecode}" />
					<if test="${movie.certification}=">
						<!-- Fix localized rating, forced to swap order, as 'G' gets replaced inside 'PG' and 'PG-13' otherwise -->
						<replace name="certification1" input="${certification_usa[0][0]:htmldecode}" pattern="X" with="X" />
						<replace name="certification2" input="${certification1}" pattern="NC-17" with="16" />
						<replace name="certification3" input="${certification2}" pattern="R" with="16" />
						<replace name="certification4" input="${certification3}" pattern="PG-13" with="12" />
						<replace name="certification5" input="${certification4}" pattern="PG" with="10" />
						<replace name="certification6" input="${certification5}" pattern="G" with="L" />
						<set name="movie.certification" value="${certification6}" />
					</if>
				</if>
			</if>
		<!-- END: Certification -->

		<!-- START: global_options_long_summary -->
			<if test="${global_options_refresh_all_fields}=true"><set name="update_summary" value="true" /></if><if test="${movie.summary}="><set name="update_summary" value="true" /></if>
			<if test="${update_summary}=true">
				<if test="${global_options_secondary_details}&lt;=1">
					<set name="rx_plot">
						<![CDATA[
						<p class="plotpar">\s*(?<moviePlotLong>.*?)<i>.*?</i>.*?</p>|<h5>Plot Synopsis:</h5>[^>]+>\s*(?<moviePlotLong>.*?)\s*<a
						]]>
					</set>
					<set name="rx_plot2">
						<![CDATA[
						<p itemprop="description">\s*(?<moviePlotShort>[^<]+?)\s*<
						]]>
					</set>
				</if>

				<!-- Long Plot Summary -->
				<if test="${global_options_long_summary}=true">
					<!-- imdb.com (USA) -->
					<if test="${global_options_secondary_details}&lt;=1">
						<retrieve name="summary_page" url="${site}/plotsummary" />
						<parse name="summary" input="${summary_page}" regex="${rx_plot}" />
						<set name="summary_clean" value="${summary[0][0]:striptags}" />
						<set name="movie.summary" value="${summary_clean:htmldecode}" />
					</if>
					<if test="${global_options_secondary_details}>1">
						<!-- Only supporting foreign short plots for now -->
						<set name="grab_short_summary" value="true" />
					</if>

					<!-- Use short Plot Summary if no long plot exists -->
					<if test="${movie.summary}="><set name="grab_short_summary" value="true" /></if>
				</if>

				<!-- Short Plot Summary -->
				<if test="${global_options_long_summary}=false"><set name="grab_short_summary" value="true" /></if>
				<if test="${grab_short_summary}=true">
					<!-- imdb.com (USA) -->
					<if test="${global_options_secondary_details}&lt;=1">
						<parse name="summary2" input="${details_page}" regex="${rx_plot2}" />
					</if>
					<if test="${global_options_secondary_details}&lt;=6">
						<if test="${global_options_secondary_details}>1">
							<!-- imdb.de + imdb.es + imdb.fr + imdb.it + imdb.pt -->
							<parse name="summary2" input="${foreign_page}" regex="${rx_plot2}" />
						</if>
					</if>
					<!-- filmtipset.se (Swedish) -->
					<if test="${global_options_secondary_details}=7">
						<parse name="summary2" input="${foreign_page}" regex="${rx_plot2}" />
					</if>
					<!-- kvikmyndir.is (Icelandic) -->
					<if test="${global_options_secondary_details}=8">
						<parse name="summary2" input="${foreign_page}" regex="${rx_plot2}" />
					</if>
					<!-- Fallback to English if no foreign summary exists -->
					<if test="${summary2[0][0]}=">
						<if test="${global_options_secondary_summary}=true">
							<set name="rx_plot2">
								<![CDATA[
								<p itemprop="description">\s*(?<moviePlotShort>[^<]+?)\s*<
								]]>
							</set>
							<parse name="summary2" input="${details_page}" regex="${rx_plot2}" />
							<log LogLevel="Warn" Message="IMDb+ Scraper WARNING: English summary used, because no foreign one exists for: ${movie.site_id}" />
						</if>
					</if>
					<set name="summary_clean" value="${summary2[0][0]:striptags}" />
					<set name="movie.summary" value="${summary_clean:htmldecode}" />
				</if>
			</if>
		<!-- END: global_options_long_summary -->

			<!-- Test to make sure the OS does not use a (comma) for floating point results -->
			<divide name="math_node_test" value1="19.98" value2="2" result_type="float" />
			<if test="${math_node_test}!=9.99">
				<if test="${global_options_single_score}=false">
					<log LogLevel="Warn" Message="IMDb+ Scraper ERROR: Math node test FAILED - Forcing Single Score system" />
					<set name="global_options_single_score" value="true" />
				</if>
				<if test="${global_options_imdb_score}=true">
					<if test="${global_options_imdb_metascore}=true">
						<log LogLevel="Warn" Message="IMDb+ Scraper ERROR: Math node test FAILED - Forcing imdb.com score (MetaScore disabled)" />
						<set name="global_options_imdb_metascore" value="false" />
					</if>
				</if>
				<if test="${global_options_imdb_score}=false">
					<if test="${global_options_rotten_meter}=false">
						<log LogLevel="Warn" Message="IMDb+ Scraper ERROR: Math node test FAILED - Forcing RottenTomatoes critics score (Audience disabled)" />
						<set name="global_options_rotten_meter" value="true" />
					</if>
					<if test="${global_options_rotten_average}=false">
						<log LogLevel="Warn" Message="IMDb+ Scraper ERROR: Math node test FAILED - Forcing RottenTomatoes critics average rating (Percentile disabled)" />
						<set name="global_options_rotten_average" value="true" />
					</if>
				</if>
			</if>

			<!-- Get imdb + metacritics votes/scores and fix to a scale of 10 if needed -->
			<set name="rx_imdb_votes">
				<![CDATA[
				title="(?<imdbPopularity>[^\s]+) IMDb users have given an average vote of (?<imdbScore>\d+.\d+)/10"(?:.+?<span class="nobr">Metascore:\s*<strong>(?<metaScore>\d+)</strong><span class="mellow">/100</span>.+?"criticreviews"[^>]+>(?<metaPopularity>[^\s]+) reviews</a>)?
				]]>
			</set>
			<parse name="imdb_votes" input="${details_page}" regex="${rx_imdb_votes}" />
			<set name="imdb_score" value="${imdb_votes[0][1]:htmldecode}" />
			<replace name="imdb_votes_clean" input="${imdb_votes[0][0]:htmldecode}" pattern="[\,\.]" with='' />
			<if test="${math_node_test}=9.99">
				<if test="${imdb_votes[0][2]:htmldecode}>0">
					<divide name="metascore_score" value1="${imdb_votes[0][2]:htmldecode}" value2="10" result_type="float" />
				</if>
				<replace name="metascore_votes_clean" input="${imdb_votes[0][3]:htmldecode}" pattern="[\,\.]" with='' />
			</if>

			<!-- Fix empty votes to make the math 'add' node for popularity not freak out later on -->
			<if test="${imdb_votes_clean}&lt;=0">
				<set name="imdb_votes_clean" value="0" />
			</if>
			<if test="${metascore_votes_clean}&lt;=0">
				<set name="metascore_votes_clean" value="0" />
			</if>

			<set name="votes_sub_total" value="0" />
			<add name="votes_sub_total" value1="${imdb_votes_clean}" value2="${metascore_votes_clean}" />

		<!-- START: global_options_imdb_score -->

			<!-- IMDb -->
			<if test="${global_options_imdb_score}=true">
				<if test="${global_options_single_score}=true">
					<!-- metacritics.com metascore + votes -->
					<if test="${global_options_imdb_metascore}=true">
						<set name="movie.score" value="${metascore_score}" />
						<set name="movie.popularity" value="${metascore_votes_clean}" />
					</if>
					<!-- imdb.com score + votes -->
					<if test="${global_options_imdb_metascore}=false">
						<set name="movie.score" value="${imdb_score}" />
						<set name="movie.popularity" value="${imdb_votes_clean}" />
					</if>
				</if>
				<if test="${global_options_single_score}=false">
					<!-- Averaging imdb and metacritics.com metascore, and totalling their votes -->
					<if test="${global_options_min_imdb_votes}=true">
						<if test="${metascore_score}>0">
							<!-- Make sure that the imdb score has at least 100 votes -->
							<if test="${imdb_votes_clean}>19">
								<add name="rating_total" value1="${imdb_score}" value2="${metascore_score}" result_type="float" />
								<if test="${rating_total}>0">
									<divide name="movie.score" value1="${rating_total}" value2="2" result_type="float" />
									<if test="${movie.score}>10">
										<log LogLevel="Warn" Message="IMDb+ Scraper ERROR: Math node bug #1 detected on &lt;divide&gt; node." />
									</if>
								</if>
							</if>
							<if test="${imdb_votes_clean}&lt;=19">
								<set name="movie.score" value="${metascore_score}" />
							</if>
						</if>
						<if test="${metascore_score}&lt;=0">
							<if test="${imdb_votes_clean}>19">
								<set name="movie.score" value="${imdb_score}" />
							</if>
							<if test="${imdb_votes_clean}&lt;=19">
								<set name="movie.score" value="0" />
							</if>
						</if>
					</if>
					<if test="${global_options_min_imdb_votes}=false">
						<!-- Before we average lets make sure that there is a Metacritics metascore -->
						<if test="${metascore_score}>0">
							<add name="rating_total" value1="${imdb_score}" value2="${metascore_score}" result_type="float" />
							<if test="${rating_total}>0">
								<divide name="movie.score" value1="${rating_total}" value2="2" result_type="float" />
								<if test="${movie.score}>10">
									<log LogLevel="Warn" Message="IMDb+ Scraper ERROR: Math node bug #2 detected on &lt;divide&gt; node." />
								</if>
							</if>
						</if>
						<if test="${metascore_score}&lt;=0">
							<set name="movie.score" value="${imdb_score}" />
						</if>
					</if>
					<set name="movie.popularity" value="${votes_sub_total}" />
				</if>
			</if>

			<!-- RottenTomatoes -->
			<if test="${global_options_imdb_score}=false">
				<!-- Adjust IMDb ID to be compatible with RottenTomatoes -->
				<replace name="imdb_id_fixed" input="${movie.imdb_id}" pattern="tt" with='' />
				<!-- Retrieve detail page from RottenTomatoes -->
				<retrieve name="rotten_details" url="http://www.rottentomatoes.com/alias?type=imdbid&amp;s=${imdb_id_fixed}" />

				<set name="rx_rotten_tomatometer">
					<![CDATA[
					(?:<span (?:itemprop="ratingValue" )?id="all-critics-meter"[^>]+>(?<rtAllPercentage>\d{1,3}?)</span>.+?<p class="critic_stats">\D*(?<rtAllAverage>\d+(?:\.\d+)?)/10\D*(?<rtAllVotes>\d+).+?<span id="all-critics-meter"[^>]+>(?<rtTopPercentage>\d{1,3}?)</span>.+?<p class="critic_stats">\D*(?<rtTopAverage>\d+(?:\.\d+)?)/10\D*(?<rtTopVotes>\d+).+?)?<span class="meter[^"]+">(?<rtPercentage>\d{1,3}?)</span>[^<]*<p class="critic_stats">(?:\D*(?<rtAverage>\d+(?:\.\d+)?)/5)?\D*(?<rtVotes>\d+[,.]?\d+)
					]]>
				</set>
				<parse name="rotten_rating" input="${rotten_details}" regex="${rx_rotten_tomatometer}" />

				<if test="${global_options_single_score}=true">
					<!-- Obtain TomatoMeter rating -->
					<if test="${global_options_rotten_meter}=true">
						<!-- Obtain TomatoMeter average rating -->
						<if test="${global_options_rotten_average}=true">
							<if test="${global_options_rotten_top_critics}=true">
								<set name="movie.score" value="${rotten_rating[0][4]:htmldecode}" />
								<set name="votes" value="${rotten_rating[0][5]:htmldecode}" />
							</if>
							<if test="${global_options_rotten_top_critics}=false">
								<set name="movie.score" value="${rotten_rating[0][1]:htmldecode}" />
								<set name="votes" value="${rotten_rating[0][2]:htmldecode}" />
							</if>
						</if>

						<!-- Obtain TomatoMeter percentage rating -->
						<if test="${global_options_rotten_average}=false">
							<!-- Avoid divide by zero problem -->
							<if test="${rotten_rating}!=">
								<if test="${global_options_rotten_top_critics}=true">
									<!-- Fix TomatoMeter to scale of 10 -->
									<divide name="rotten_rating_float" value1="${rotten_rating[0][3]:htmldecode}" value2="10" result_type="float" />
									<set name="votes" value="${rotten_rating[0][5]:htmldecode}" />
								</if>
								<if test="${global_options_rotten_top_critics}=false">
									<!-- Fix TomatoMeter to scale of 10 -->
									<divide name="rotten_rating_float" value1="${rotten_rating[0][0]:htmldecode}" value2="10" result_type="float" />
									<set name="votes" value="${rotten_rating[0][2]:htmldecode}" />
								</if>
								<set name="movie.score" value="${rotten_rating_float}" />
								<if test="${movie.score}>10">
									<log LogLevel="Warn" Message="IMDb+ Scraper ERROR: Math node bug #3 detected on &lt;divide&gt; node." />
								</if>
							</if>
						</if>

						<!-- Popularity RottenTomatoes TomatoMeter -->
						<replace name="votes_clean" input="${votes}" pattern="[\,\.]" with='' />
						<set name="movie.popularity" value="${votes_clean}" />
					</if>

					<!-- Obtain Audience rating -->
					<if test="${global_options_rotten_meter}=false">
						<!-- Obtain Audience average rating -->
						<if test="${global_options_rotten_average}=true">
							<!-- Score (multiplied by 2 to match IMDb rating of 10) -->
							<multiply name="score_fixed" value1="${rotten_rating[0][7]:htmldecode}" value2="2" result_type="float" />
							<set name="movie.score" value="${score_fixed}" />
						</if>

						<!-- Obtain Audience percentage rating -->
						<if test="${global_options_rotten_average}=false">
							<if test="${rotten_rating}!=">
								<!-- Fix TomatoMeter to scale of 10 -->
								<divide name="rotten_rating_float" value1="${rotten_rating[0][6]:htmldecode}" value2="10" result_type="float" />
								<set name="movie.score" value="${rotten_rating_float}" />
								<if test="${movie.score}>10">
									<log LogLevel="Warn" Message="IMDb+ Scraper ERROR: Math node bug #4 detected on &lt;divide&gt; node." />
								</if>
							</if>
						</if>

						<!-- Popularity RottenTomatoes Audience -->
						<replace name="votes_clean" input="${rotten_rating[0][8]:htmldecode}" pattern="[\,\.]" with='' />
						<set name="movie.popularity" value="${votes_clean}" />
					</if>
				</if>
				<if test="${global_options_single_score}=false">
					<!-- Averaging imdb + metascore + RT, and totalling their votes -->
					<set name="score_sub_total" value="0" />
					<set name="score_sub_divider" value="0" />

					<if test="${global_options_min_imdb_votes}=false"><set name="include_imdb_vote" value="true" /></if><if test="${global_options_min_imdb_votes}=true"><if test="${imdb_votes_clean}>19"><set name="include_imdb_vote" value="true" /></if></if>
					<if test="${include_imdb_vote}=true">
						<if test="${imdb_score}>0">
							<add name="score_sub_total" value1="${score_sub_total}" value2="${imdb_score}" result_type="float" />
							<add name="score_sub_divider" value1="${score_sub_divider}" value2="1" />
						</if>
					</if>
					<if test="${metascore_score}>0">
						<add name="score_sub_total" value1="${score_sub_total}" value2="${metascore_score}" result_type="float" />
						<add name="score_sub_divider" value1="${score_sub_divider}" value2="1" />
					</if>
					<if test="${rotten_rating[0][1]:htmldecode}>0">
						<add name="score_sub_total" value1="${score_sub_total}" value2="${rotten_rating[0][1]:htmldecode}" result_type="float" />
						<add name="score_sub_divider" value1="${score_sub_divider}" value2="1" />
					</if>
					<if test="${rotten_rating[0][4]:htmldecode}>0">
						<add name="score_sub_total" value1="${score_sub_total}" value2="${rotten_rating[0][4]:htmldecode}" result_type="float" />
						<add name="score_sub_divider" value1="${score_sub_divider}" value2="1" />
					</if>
					<if test="${rotten_rating[0][7]:htmldecode}>0">
						<multiply name="rotten_rating_float" value1="${rotten_rating[0][7]:htmldecode}" value2="2" result_type="float" />
						<add name="score_sub_total" value1="${score_sub_total}" value2="${rotten_rating_float}" result_type="float" />
						<add name="score_sub_divider" value1="${score_sub_divider}" value2="1" />
					</if>
					<!-- Use RottenTomatoes Audience score if we do not have any score yet. -->
					<if test="${score_sub_total}=0">
						<if test="${rotten_rating[0][6]:htmldecode}>0">
							<divide name="rotten_rating_float" value1="${rotten_rating[0][6]:htmldecode}" value2="10" result_type="float" />
							<add name="score_sub_total" value1="${score_sub_total}" value2="${rotten_rating_float}" result_type="float" />
							<add name="score_sub_divider" value1="${score_sub_divider}" value2="1" />
						</if>
					</if>
					<if test="${score_sub_divider}>0">
						<divide name="movie.score" value1="${score_sub_total}" value2="${score_sub_divider}" result_type="float" />
						<if test="${movie.score}>10">
							<log LogLevel="Warn" Message="IMDb+ Scraper ERROR: Math node bug #5 detected on &lt;divide&gt; node." />
						</if>
					</if>

					<replace name="votes_clean" input="${rotten_rating[0][2]:htmldecode}" pattern="[\,\.]" with='' />
					<if test="${votes_clean}>0">
						<add name="votes_sub_total" value1="${votes_sub_total}" value2="${votes_clean}" />
					</if>
					<replace name="votes_clean" input="${rotten_rating[0][5]:htmldecode}" pattern="[\,\.]" with='' />
					<if test="${votes_clean}>0">
						<add name="votes_sub_total" value1="${votes_sub_total}" value2="${votes_clean}" />
					</if>
					<replace name="votes_clean" input="${rotten_rating[0][8]:htmldecode}" pattern="[\,\.]" with='' />
					<if test="${votes_clean}>0">
						<add name="votes_sub_total" value1="${votes_sub_total}" value2="${votes_clean}" />
					</if>
					<set name="movie.popularity" value="${votes_sub_total}" />
				</if>

				<!-- Since we already have the RottenTomatoes results, lets use their summary if imdb.com did not have one -->
				<if test="${movie.summary}=">
					<if test="${global_options_secondary_details}&lt;=1">
						<set name="rx_rotten_summary">
							<![CDATA[
							<span\sid="movie_synopsis_all"\sstyle="display:\snone;">(?<rottenSummary>[^<]+)</span>
							]]>
						</set>
						<parse name="rotten_summary" input="${rotten_details}" regex="${rx_rotten_summary}" />
						<set name="movie.summary" value="${rotten_summary[0][0]:htmldecode}" />
					</if>
				</if>
				<!-- Might as well verify the runtime -->
				<if test="${movie.runtime}=0">
					<set name="rx_rotten_runtime">
						<![CDATA[
						<span class="label">Running Time:</span>\s<span[^>]+>(?<runtimeHours>\d+) hr. (?<runtimeMinutes>\d+) min.</span>
						]]>
					</set>
					<parse name="rotten_runtime" input="${rotten_details}" regex="${rx_rotten_runtime}" />
					<!-- Time for some math to get runtime in minutes -->
					<multiply name="runtime_minutes" value1="60" value2="${rotten_runtime[0][0]}" result_type="int" />
					<add name="runtime_minutes" value1="${runtime_minutes}" value2="${rotten_runtime[0][1]}" />
					<set name="movie.runtime" value="${runtime_minutes}" />
				</if>
			</if>
		<!-- END: global_options_imdb_score -->

			<if test="${global_options_refresh_all_fields}=true"><set name="update_this" value="true" /></if><if test="${movie.alternate_titles}="><set name="update_this" value="true" /></if><if test="${movie.title}="><set name="update_this" value="true" /></if><if test="${movie.year}="><set name="update_this" value="true" /></if>
			<if test="${update_this}=true">
				<!-- AKA page -->
				<set name="rx_aka">
					<![CDATA[
					<tr>\s+?<td>(.+?)</td>\s+?<td>(.+?)</td>.*?</tr>
					]]>
				</set>
				<retrieve name="aka_page" url="${site}/releaseinfo" />
				<parse name="akas" input="${aka_page}" regex="${rx_aka}" />
				<set name="movie.alternate_titles" value='' />
				<loop name="currAka" on="akas" limit="50">
					<set name="movie.alternate_titles" value="${movie.alternate_titles}|${currAka[0]:htmldecode}" />
				</loop>

				<!-- Test for rare case when an English movie gets a new title -->
				<if test="${title_year[0][0]}!=">
					<set name="rx_aka_english">
						<![CDATA[
						<h5><a name="akas">Also Known As \(AKA\)</a></h5>.*?<td>(?<movieTitleEnglish>[^<]+)</td>\s*<td>[^<]*USA \(new title\)[^<]*</td>.*?</table>
						]]>
					</set>
					<parse name="rare_title_change" input="${aka_page}" regex="${rx_aka_english}" />
					<if test="${rare_title_change[0][0]}!=">
						<if test="${rare_title_change[0][0]}!=${title_year[0][0]}">
							<set name="title_year[0][0]" value='' />
						</if>
					</if>
				</if>

				<!-- Find English title on AKA page if we failed to get one at the beginning -->
				<if test="${title_year[0][0]}=">
					<if test="${global_options_uk_rating}=false">
						<!-- First making sure there is no display title entry -->
						<set name="rx_aka_english">
							<![CDATA[
							<title>(?:IMDb[\s-]*)?(?<movieTitleOriginal>[^\(]+?)\s*\(\D*(?<movieYear>\d{4})[\/IVX]*\).*?</title>.+?<h5><a name="akas">Also Known As \(AKA\)</a></h5>.*<td>(?<movieTitleEnglish>[^<]+)</td>\s*<td>[^<]*(?:USA\s*\(imdb display title\))[^<]*</td>.*?</table>
							]]>
						</set>
						<parse name="title_year" input="${aka_page}" regex="${rx_aka_english}" />

						<if test="${title_year[0][0]}=">
							<!-- Checking for 'last' added USA title first -->
							<set name="rx_aka_english">
								<![CDATA[
								<title>(?:IMDb[\s-]*)?(?<movieTitleOriginal>[^\(]+?)\s*\(\D*(?<movieYear>\d{4})[\/IVX]*\).*?</title>.+?<h5><a name="akas">Also Known As \(AKA\)</a></h5>.*<td>(?<movieTitleEnglish>[^<]+)</td>\s*<td>[^<]*(?:USA(?!\s*\((?:working title|literal English title|promotional title|IMAX version)\)))[^<]*</td>.*?</table>
								]]>
							</set>
							<parse name="title_year" input="${aka_page}" regex="${rx_aka_english}" />
						</if>
					</if>
					<if test="${title_year[0][0]}=">
						<if test="${global_options_uk_rating}=true">
							<set name="rx_aka_english">
								<![CDATA[
								<title>(?:IMDb[\s-]*)?(?<movieTitleOriginal>[^\(]+?)\s*\(\D*(?<movieYear>\d{4})[\/IVX]*\).*?</title>.+?<h5><a name="akas">Also Known As \(AKA\)</a></h5>.*<td>(?<movieTitleEnglish>[^<]+)</td>\s*<td>[^<]*(?:UK\s*\(imdb display title\))[^<]*</td>.*?</table>
								]]>
							</set>
							<parse name="title_year" input="${aka_page}" regex="${rx_aka_english}" />
						</if>

						<if test="${title_year[0][0]}=">
							<!-- Checking for International English title -->
							<set name="rx_aka_english">
								<![CDATA[
								<title>(?:IMDb[\s-]*)?(?<movieTitleOriginal>[^\(]+?)\s*\(\D*(?<movieYear>\d{4})[\/IVX]*\).*?</title>.+?<h5><a name="akas">Also Known As \(AKA\)</a></h5>.*?<td>(?<movieTitleEnglish>[^<]+)</td>\s*<td>[^<]*(?:International(?!\s*\((?:working title|literal English title|promotional title|IMAX version)\)))[^<]*</td>.*?</table>
								]]>
							</set>
							<parse name="title_year" input="${aka_page}" regex="${rx_aka_english}" />

							<if test="${title_year[0][0]}=">
								<!-- Locate English 'Hong Kong' title -->
								<set name="rx_aka_english">
									<![CDATA[
									<title>(?:IMDb[\s-]*)?(?<movieTitleOriginal>[^\(]+?)\s*\(\D*(?<movieYear>\d{4})[\/IVX]*\).*?</title>.+?<h5><a name="akas">Also Known As \(AKA\)</a></h5>.+?<td>(?<movieTitleEnglish>[^<]+)</td>\s*<td>Hong Kong[^<]*English[^<]*</td>.*?</table>
									]]>
								</set>
								<parse name="title_year" input="${aka_page}" regex="${rx_aka_english}" />

								<if test="${title_year[0][0]}=">
									<!-- Accepting any remaining English title -->
									<set name="rx_aka_english">
										<![CDATA[
										<title>(?:IMDb[\s-]*)?(?<movieTitleOriginal>[^\(]+?)\s*\(\D*(?<movieYear>\d{4})[\/IVX]*\).*?</title>.+?<h5><a name="akas">Also Known As \(AKA\)</a></h5>.+?<td>(?<movieTitleEnglish>[^<]+)</td>\s*<td>[^<]*English[^<]*</td>.*?</table>
										]]>
									</set>
									<parse name="title_year" input="${aka_page}" regex="${rx_aka_english}" />

									<if test="${global_options_uk_rating}=true">
										<if test="${title_year[0][0]}=">
											<!-- Give USA title one last chance for UK users -->
											<set name="rx_aka_english">
												<![CDATA[
												<title>(?:IMDb[\s-]*)?(?<movieTitleOriginal>[^\(]+?)\s*\(\D*(?<movieYear>\d{4})[\/IVX]*\).*?</title>.+?<h5><a name="akas">Also Known As \(AKA\)</a></h5>.*<td>(?<movieTitleEnglish>[^<]+)</td>\s*<td>[^<]*(?:USA\s*\(imdb display title\))[^<]*</td>.*?</table>
												]]>
											</set>
											<parse name="title_year" input="${aka_page}" regex="${rx_aka_english}" />

											<if test="${title_year[0][0]}=">
												<set name="rx_aka_english">
													<![CDATA[
													<title>(?:IMDb[\s-]*)?(?<movieTitleOriginal>[^\(]+?)\s*\(\D*(?<movieYear>\d{4})[\/IVX]*\).*?</title>.+?<h5><a name="akas">Also Known As \(AKA\)</a></h5>.*<td>(?<movieTitleEnglish>[^<]+)</td>\s*<td>[^<]*(?:USA(?!\s*\((?:working title|literal English title|promotional title|IMAX version)\)))[^<]*</td>.*?</table>
													]]>
												</set>
												<parse name="title_year" input="${aka_page}" regex="${rx_aka_english}" />
											</if>
										</if>
									</if>

									<if test="${title_year[0][0]}=">
										<!-- Last resort by looking for (undefined) titles -->
										<set name="rx_aka_english">
											<![CDATA[
											<title>(?:IMDb[\s-]*)?(?<movieTitleOriginal>[^\(]+?)\s*\(\D*(?<movieYear>\d{4})[\/IVX]*\).*?</title>.+?<h5><a name="akas">Also Known As \(AKA\)</a></h5>.+?<td>(?<movieTitleEnglish>[^<]+)</td>\s*<td>[^<]*undefined[^<]*</td>.*?</table>
											]]>
										</set>
										<parse name="title_year" input="${aka_page}" regex="${rx_aka_english}" />

										<if test="${title_year[0][0]}=">
											<!-- Giving up, and using the AKA title -->
											<set name="rx_aka_english">
												<![CDATA[
												<title>(?:IMDb[\s-]*)?(?<movieTitleOriginal>[^\(]+?)\s*\(\D*(?<movieYear>\d{4})[\/IVX]*\).*?</title>.*?<meta name="title" content="(?<movieTitleEnglish>[^\(]+?)\s*\(
												]]>
											</set>
											<parse name="title_year" input="${aka_page}" regex="${rx_aka_english}" />
										</if>
									</if>
								</if>
							</if>
						</if>
					</if>
					<!-- the title_year array is in reverse on the AKA page -->
					<if test="${global_options_foreign_title}=true">
						<!-- prevent title duplicate on some foreign movies with English titles -->
						<if test="${title_year[0][2]:htmldecode}!=${title_year[0][0]:htmldecode}">
							<if test="${global_options_foreign_first}=true">
								<set name="movie.title" value="${title_year[0][0]:htmldecode} (${title_year[0][2]:htmldecode})" />
							</if>
							<if test="${global_options_foreign_first}=false">
								<set name="movie.title" value="${title_year[0][2]:htmldecode} (${title_year[0][0]:htmldecode})" />
							</if>
						</if>
						<if test="${title_year[0][2]:htmldecode}=${title_year[0][0]:htmldecode}">
							<set name="movie.title" value="${title_year[0][2]:htmldecode}" />
						</if>
					</if>
					<if test="${global_options_foreign_title}=false">
						<set name="movie.title" value="${title_year[0][2]:htmldecode}" />
					</if>
					<set name="movie.year" value="${title_year[0][1]:htmldecode}" />
				</if>
			</if>

			<!-- Details URL -->
			<!-- This overwrites any special edition title abuse from search node as well -->
			<set name="movie.details_url" value="${site}" />

			<!-- Rename titles for purpose of grouping, based on contents of default XML file -->
			<if test="${global_options_rename_titles}=true">
				<set name="rx_rename_check_prefix">
					<![CDATA[
					(?<=<imdbplus>.*)<rename[\t\s]+id="
					]]>
				</set>
				<set name="rx_rename_check_postfix">
					<![CDATA[
					"[\t\s]+(?:title="(?<renameTitle>[^"]+)")?(?:[\t\s]*sortby="(?<renameSortBy>[^"]+)")?[\t\s]*/>
					]]>
				</set>
				<retrieve name="file" file="C:\Rename dBase IMDb+ Scraper.xml" encoding="UTF-8" />
				<parse name="fileRename" input="${file}" regex="${rx_rename_check_prefix}${movie.imdb_id}${rx_rename_check_postfix}" />
				<if test="${fileRename.count}=1">
					<!-- Prevent title from getting cleared if only the sortby field is being adjusted -->
					<if test="${fileRename[0][0]}!=">
						<set name="movie.title" value="${fileRename[0][0]}" />
						<log LogLevel="Info" Message="IMDb+ Scraper: Title adjusted via Default Rename XML for: ${movie.imdb_id}" />
					</if>
					<if test="${fileRename[0][1]}!=">
						<set name="movie.sortby" value="${fileRename[0][1]}" />
						<log LogLevel="Info" Message="IMDb+ Scraper: SortBy adjusted via Default Rename XML for: ${movie.imdb_id}" />
					</if>
				</if>
				<if test="${fileRename.count}&gt;1">
					<log LogLevel="Warn" Message="IMDb+ Scraper ERROR: Default Rename XML file has more then one entry for: ${movie.imdb_id}" />
				</if>

				<!-- Rename titles for purpose of grouping or title fixes, based on contents of custom XML file -->
				<set name="rx_rename_check_prefix">
					<![CDATA[
					(?<=<imdbplus>.*)<rename[\t\s]+id="
					]]>
				</set>
				<set name="rx_rename_check_postfix">
					<![CDATA[
					"[\t\s]+(?:title="(?<renameTitle>[^"]+)")?(?:[\t\s]*sortby="(?<renameSortBy>[^"]+)")?[\t\s]*/>
					]]>
				</set>
				<retrieve name="file" file="C:\Rename dBase IMDb+ Scraper (Custom).xml" encoding="UTF-8" />
				<parse name="fileRename" input="${file}" regex="${rx_rename_check_prefix}${movie.imdb_id}${rx_rename_check_postfix}" />
				<if test="${fileRename.count}=1">
					<!-- Prevent title from getting cleared if only the sortby field is being adjusted -->
					<if test="${fileRename[0][0]}!=">
						<set name="movie.title" value="${fileRename[0][0]}" />
						<log LogLevel="Info" Message="IMDb+ Scraper: Title adjusted via Custom Rename XML for: ${movie.imdb_id}" />
					</if>
					<if test="${fileRename[0][1]}!=">
						<set name="movie.sortby" value="${fileRename[0][1]}" />
						<log LogLevel="Info" Message="IMDb+ Scraper: SortBy adjusted via Custom Rename XML for: ${movie.imdb_id}" />
					</if>
				</if>
				<if test="${fileRename.count}&gt;1">
					<log LogLevel="Warn" Message="IMDb+ Scraper ERROR: Custom Rename XML file has more then one entry for: ${movie.imdb_id}" />
				</if>
			</if>

			<!-- Adjust title if this is a special edition -->
			<if test="${special_edition[0][0]}!=">
				<set name="movie.title" value="${movie.title} ${special_edition[0][0]}" />
			</if>
			<if test="${special_edition[0][0]}=">
				<if test="${special_backup[0][0]}!=">
					<set name="movie.title" value="${movie.title} ${special_backup}" />
				</if>
			</if>
		</if>
		<if test="${movie.site_id}=">
			<log LogLevel="Warn" Message="IMDb+ Scraper ERROR: Aborting details node, movie.site_id is empty" />
		</if>
	</action>


<!-- Search Node -->

	<action name="search">

		<!-- Regular Expressions -->
		<set name="rx_imdb_results">
			<![CDATA[
			<title>(?:IMDb[\s-]*)?(?:IMDb[\s-]*)?(.+?)\(\D*(\d{4})[\/IVX]*\).*?</title>.+?(tt\d{7})/fullcredits
			]]>
		</set>

		<set name="rx_special_editions">
			<![CDATA[
			([\(\[\{](?:3D|Extended|Unrated|Director's Cut|Alternate Ending)(?: Edition)?[\}\]\)])
			]]>
		</set>

		<!-- Retrieve result using IMDB id (if provided) -->
		<if test="${search.imdb_id}!=">
			<retrieve name="imdb_page" url="http://akas.imdb.com/title/${search.imdb_id}" />
			<parse name="imdb_results" input="${imdb_page}" regex="${rx_imdb_results}" />
			<if test="${imdb_results[0][2]}!=">
				<!-- Direct match found, let's get the results and be done with it -->
				<set name="movie[0].title" value="${imdb_results[0][0]:htmldecode}" />
				<set name="movie[0].year" value="${imdb_results[0][1]:htmldecode}" />
				<set name="movie[0].imdb_id" value="${imdb_results[0][2]:htmldecode}" />
				<set name="movie[0].site_id" value="${imdb_results[0][2]:htmldecode}" />
				<set name="movie[0].popularity" value="100" />
			</if>
		</if>

		<!-- No sense looking up any other movie if we have found a direct IMDb match -->
		<if test="${movie[0].site_id}=">

			<set name="offset" value="0" />

			<set name="rx_details_page_block">
				<![CDATA[
				<title>.+?\(\D*\d{4}[\/IVX]*\).*?</title>.+</body>
				]]>
			</set>
			<set name="rx_aka_details">
				<![CDATA[
				<tr>\s+?<td>(.+?)</td>\s+?<td>(.+?)</td>.*?</tr>
				]]>
			</set>
			<set name="rx_aka">
				<![CDATA[
				aka "(.+?)"
				]]>
			</set>

			<!-- Retrieve other results using "Title (year)" -->

			<set name="query_year" value='' />
			<if test="${search.year}>1800">
				<set name="query_year" value="+(${search.year})" />
			</if>

			<retrieve name="search_page" url="http://akas.imdb.com/find?s=tt;q=${search.title:safe(ISO-8859-1)}${query_year}" />

			<!-- if we got a details page, this is used. if not, regex does not match so we dont process the loop-->
			<parse name="details_page_block" input="${search_page}" regex="${rx_details_page_block}" />
			<loop name="details_page_verified" on="details_page_block" limit="99">
				<add name="counter" value1="${count}" value2="${offset}" />
				<parse name="imdb_results" input="${details_page_verified}" regex="${rx_imdb_results}" />
				<set name="movie[${counter}].title" value="${imdb_results[0][0]:htmldecode}" />
				<set name="movie[${counter}].year" value="${imdb_results[0][1]:htmldecode}" />
				<set name="movie[${counter}].imdb_id" value="${imdb_results[0][2]}" />
				<set name="movie[${counter}].site_id" value="${imdb_results[0][2]}" />

				<!-- AKA page -->
				<retrieve name="aka_page" url="http://akas.imdb.com/title/${imdb_results[0][2]}/releaseinfo" />
				<parse name="akas" input="${aka_page}" regex="${rx_aka_details}" />
				<set name="movie[${counter}].alternate_titles" value='' />
				<loop name="currAka" on="akas" limit="50">
					<set name="movie[${counter}].alternate_titles" value="${movie[${counter}].alternate_titles}|${currAka[0]:htmldecode}" />
				</loop>

				<subtract name="movie[${counter}].popularity" value1="100" value2="${counter}" />
			</loop>

			<!-- No sense looking up any other movie if we found a details page already -->
			<if test="${movie[0].site_id}=">

				<set name="rx_search_page">
					<![CDATA[
					<meta name="title" content="IMDb Title Search">.+</body>
					]]>
				</set>

				<!-- if we got a search result page, this is used. if not, regex does not match so we dont process the outer loop. -->
				<parse name="search_results_block" input="${search_page}" regex="${rx_search_page}" />
				<if test="${search_results_block}!=">

					<set name="rx_title_exact_match">
						<![CDATA[
						<p><b>Popular Titles</b> \(Displaying \d{2} Results\).*?<p><b>Titles \(Exact Matches\)</b>.*?>\d+\.<.*?><a href="/title/(tt\d{7})/".*?>(.+?)</a> \((\d{4})\)
						]]>
					</set>

					<!-- to prevent an exact title match from being burried by popular matches, lets grab the first exact title match result -->
					<parse name="title_exact_match" input="${search_results_block}" regex="${rx_title_exact_match}" />
					<if test="${title_exact_match}!=">
						<set name="movie[0].imdb_id" value="${title_exact_match[0][0]:htmldecode}" />
						<set name="movie[0].site_id" value="${title_exact_match[0][0]:htmldecode}" />
						<set name="movie[0].title" value="${title_exact_match[0][1]:htmldecode}" />
						<set name="movie[0].year" value="${title_exact_match[0][2]:htmldecode}" />
						<set name="movie[0].popularity" value="100" />
						<set name="offset" value="1" />
					</if>

					<set name="rx_search_results">
						<![CDATA[
						><a href="/title/(tt\d{7})/"[^>]+>(?!&#34;)([^<]+)</a> \((\d{4})[\/IVX]*\)(?! \(VG\))(?:[^<].*?>(?=aka ")?(.+?)?</td>)?
						]]>
					</set>

					<!-- process the rest of the search page and obtain all the popular results -->
					<loop name="search_results_verified" on="search_results_block" limit="99">
						<parse name="movie_details" input="${search_results_verified}" regex="${rx_search_results}" />
						<loop name="curr_details" on="movie_details" limit="99">
							<add name="counter" value1="${count}" value2="${offset}" />
							<set name="movie[${counter}].imdb_id" value="${curr_details[0]:htmldecode}" />
							<set name="movie[${counter}].site_id" value="${curr_details[0]:htmldecode}" />
							<set name="movie[${counter}].title" value="${curr_details[1]:htmldecode}" />

							<parse name="akas" input="${curr_details[3]:htmldecode}" regex="${rx_aka}" />
							<set name="movie[${counter}].alternate_titles" value='' />
							<loop name="currAka" on="akas" limit="50">
								<set name="movie[${counter}].alternate_titles" value="${movie[${counter}].alternate_titles}|${currAka[0]}" />
							</loop>

							<set name="movie[${counter}].year" value="${curr_details[2]:htmldecode}" />
							<subtract name="movie[${counter}].popularity" value1="100" value2="${counter}" />
						</loop>
					</loop>
				</if>
			</if>
		</if>

		<!-- Using unused 'details_url' to pass special edition strings onto details node -->
		<parse name="special_edition" input="${search.filename_noext}" regex="${rx_special_editions}" />
		<if test="${special_edition[0][0]}!=">
			<set name="movie[0].details_url" value="###${special_edition}###" />
		</if>
		<if test="${special_edition[0][0]}=">
			<!-- Filename came up empty; lets try foldername before giving up -->
			<parse name="special_edition" input="${search.foldername}" regex="${rx_special_editions}" />
			<if test="${special_edition[0][0]}!=">
				<set name="movie[0].details_url" value="###${special_edition}###" />
			</if>
		</if>
	</action>


<!-- Covers Node -->

	<action name="get_cover_art">
		<!-- if the site id is not set try to set it using the imdb id -->
		<if test="${movie.site_id}=">
			<if test="${movie.imdb_id}!=">
				<set name="movie.site_id" value="${movie.imdb_id}" />
			</if>
		</if>
		
		<!-- if we have a site id (imdb id) we can continue -->
		<if test="${movie.site_id}!=">

			<!-- Retrieve details -->
			<retrieve name="details_page" url="http://www.imdb.com/title/${movie.site_id}/" />

			<!-- Get cover directly by manipulating details page thumbnail -->
			<set name="rx_cover">
				<![CDATA[
				<a\s*onclick="[^"]+"\s*href="/media/.+?/tt\d{7}"[^>]+><img.+?src="([^_]+_V1)\.[^\.]+([^"]+)".+?alt=".+?Poster"
				]]>
			</set>
			<parse name="cover_src" input="${details_page}" regex="${rx_cover}" />

			<!-- set cover -->
			<set name="cover_art[0].url" value="${cover_src[0][0]}${cover_src[0][1]}" />
		</if>
	</action>
</ScriptableScraper>